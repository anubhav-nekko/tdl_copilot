;; ====================================================================================
;; TDL Enhancements for CW Bajaj Finance Invoice Details in EXPINV, EXPSMP, and POS
;; Created By: suman on 2021-08-02 17:45
;; ====================================================================================

;; ------------------------------------------------------------------------------------
;; EXPINV Invoice Details Extension
;; Condition: Only applicable for Sales and if CW Bajaj Finance is enabled
;; ------------------------------------------------------------------------------------
[#Line: EXPINV InvDetails]
add:option:cwexpinvdetsaleopt:@@issales and @@cwBajajFinanceEnabled

;; ------------------------------------------------------------------------------------
;; Line option added under EXPINV to explode additional CW DO and Serial Details
;; ------------------------------------------------------------------------------------
[!line:cwexpinvdetsaleopt]
  add:explode:cwdodetails

  ;; ------------------------------------------------------------------
  ;; Part Definition: Contains both DO and Serial Number details lines
  ;; ------------------------------------------------------------------
  [part:cwdodetails]
    line:cwdoline ,cwserialline

  ;; ----------------------------------------------------------
  ;; DO Number Line
  ;; Fields: snf (label) and nf (value)
  ;; Displays: "Do Number: <deal id>"
  ;; Visibility: Based on CW DO print options and export mode
  ;; ----------------------------------------------------------
  [line:cwdoline]
    field:snf,nf
    Local: Field: snf: Set As:""
    Local: Field: nf: Set As:"Do Number: " +$cwdealid
    Local: field: snf: Width:3
    Invisible: if $$isempty:$cwdealid then yes else if $$InExportMode then @@expcwdonoprintopt="no" else not @@cwdonoprintopt

  ;; ------------------------------------------------------------
  ;; Serial Number Line
  ;; Fields: snf (label) and nf (value)
  ;; Displays: "Serial No: <serial number>"
  ;; Visibility: Complex logic based on export mode and batch settings
  ;; ------------------------------------------------------------
  [line:cwserialline]
    field:snf,nf
    Local: Field: snf: Set As:""
    Local: Field: nf: Set As:"Serial No:  "+$cwSerialNo
    Local: field: snf: Width:3
    Invisible: if $$isempty:$cwSerialNo then yes else if $$inexportmode then +
    if @@expcwserialprintopt="no" then yes else if @@cwItemhasBatchEnabled then not @@cwExportWithBatch else no else +
    if @@cwserialprintopt="no" then yes else if @@cwItemhasBatchEnabled then not @@cwPrintWithBatch else no

;; ------------------------------------------------------------------------------------
;; EXPSMP Invoice Details Extension
;; Condition: Only applicable for Sales and if CW Bajaj Finance is enabled
;; Same line explosion logic reused as in EXPINV
;; ------------------------------------------------------------------------------------
[#Line: EXPSMP InvDetails]
add:option:cwexpsmpinvdetailssimple:@@issales and @@cwBajajFinanceEnabled

[!line:cwexpsmpinvdetailssimple]
  add:explode:cwdodetails

;; ------------------------------------------------------------------------------------
;; POS Invoice Details Extension
;; Condition: Only applicable for Sales and if CW Bajaj Finance is enabled
;; Same line explosion logic reused, with additional local fields inserted at beginning
;; ------------------------------------------------------------------------------------
[#Line: POS InvDetails]
add:option:cwposinvdetailopt:@@issales and @@cwBajajFinanceEnabled

[!line:cwposinvdetailopt]
  add:explode:cwdodetails
  local:line:cwdoline:add:field:atbeginning:snfx
  local:line:cwserialline:add:field:atbeginning:snfx
