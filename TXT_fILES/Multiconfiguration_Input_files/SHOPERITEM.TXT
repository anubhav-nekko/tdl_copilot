;===============================================================================
; SHOPERITEM.TXT
; Created By: Suman on 2014-01-16 11:06, ID:
; Purpose: Provides a "Shoper Item Export" report in Tally, listing stock items
;          with key attributes for export or analysis, with filter and custom fields.
;===============================================================================

;------------------------------------------------------------------------------
; MENU INTEGRATION
;------------------------------------------------------------------------------

[#Menu: Inventory books]
    add:Key Item:before:@@locquit: @@cwshoperitem  : S : Display : RepShoperItemExplode

[System: Formula]
    cwshoperitem: "Shoper Item Export"

;------------------------------------------------------------------------------
; MAIN REPORT AND FORM
;------------------------------------------------------------------------------

[Report: RepShoperItemExplode]
    use: Dsp Template
    Title: @@cwshoperitem
    Printset: Report Title: @@cwshoperitem
    Form: FrmShoperItemExplode
    Export: Yes
    set  : svfromdate : ##svcurrentdate
    set  : svTodate : ##svcurrentdate
    Local: Button: RelReports: Inactive: Yes

[Form: FrmShoperItemExplode]
    use: DSP Template
    Part: DspAccTitles, PrtShoperItemExplode
    Width: 100% Page
    Height: 100% Page
    Background: @@SV_STOCKSUMMARY
    delete: page break
    add: page break: ShoperItemExplodebotbrk,ShoperItemExplodebotOpbrk
    Bottom Toolbar Buttons: BottomToolBarBtn1, BottomToolBarBtn3, BottomToolBarBtn8, BottomToolBarBtn9, BottomToolBarBtn10, BottomToolBarBtn11, BottomToolBarBtn12
    add: button: cwnewbutton

[part: ShoperItemExplodebotBrk]
    line: EXPINV PageBreak
    border: thin top

[part: ShoperItemExplodebotopbrk]
    use: dspacctitles
    add: part: ShoperItemExplodeTitlePart

[part: ShoperItemExplodeTitlePart]
    line: LnShoperItemExplodeTitle

[line: LnShoperItemExplodeCurrPeriod]
    field: fwf, fwf2
    Local: field: fwf2: Align: Right
    Local: Field: fwf: Style: normal bold
    Local: Field: fwf2: Style: normal bold
    Local: Field: fwf2: Set As: @@dspDateStr
    invisible: $$inprintmode

[part: PrtShoperItemExplode]
    Line: LnShoperItemExplodeTitle, LnShoperItemExplode
    repeat: LnShoperItemExplode: ColShoperItemExplode
    scroll: both
    Common Border: Yes
    Total: Qtyf, amtf

;------------------------------------------------------------------------------
; DATA COLLECTION
;------------------------------------------------------------------------------

[Collection: ColShoperItemExplode]
    use: stock item
    add: filter: ColShoperItemExplodeFilter

[system: Formula]
    ColShoperItemExplodeFilter: $partno >= ##str1

;------------------------------------------------------------------------------
; COLUMN HEADERS
;------------------------------------------------------------------------------

[Line: LnShoperItemExplodeTitle]
    use: LnShoperItemExplode
    option: titleopt
    Local: Field: snf: Set As: "Stock No"
    Local: Field: nf1: Set As: "Product"
    Local: Field: snf2: Set As: $cwsortnoStr:COMPANY:##SVCURRENTCOMPANY
    Local: Field: snf3: Set As: $cwsizeStr:COMPANY:##SVCURRENTCOMPANY
    Local: Field: snf4: Set As: $cwproductStr:COMPANY:##SVCURRENTCOMPANY
    Local: Field: snf5: Set As: $cwproductStr2:COMPANY:##SVCURRENTCOMPANY
    Local: Field: snf6: Set As: $cwproductStr3:COMPANY:##SVCURRENTCOMPANY
    Local: Field: snf7: Set As: $cwproductStr4:COMPANY:##SVCURRENTCOMPANY
    Local: Field: nf: Set As: "Item Description"
    Local: Field: numf: Set As: "TAX"
    Local: Field: numf2: Set As: "MRP"
    Local: Field: numf3: Set As: "Deler Price"
    Local: Field: numf4: Set As: "Cost Price"
    Local: Field: nf2: Set As: "Barcode Sticker Size"
    local: field: default: style: normal bold
    local: field: default: border: thin left
    local: field: default: align: centre

;------------------------------------------------------------------------------
; MAIN DATA LINE
;------------------------------------------------------------------------------

[Line: LnShoperItemExplode]
    Fields: snf, nf1, snf2, snf3, snf4, snf5, snf6, snf7, nf
    right field: numf, numf2, numf3, numf4
    Option: Alter on Enter
    local: field: qtyf: Format: "NoSymbol, Short Form, No Compact,NoZero"
    local: field: ratepf: setas: #amtf/#qtyf
    option: alter on enter
    local: field: snf: alter: stock item: $$IsStockItem
    Local: Field: snf: Set As: $partno
    Local: Field: nf1: Set As: $parent
    Local: Field: snf2: Set As: $cwsortno
    Local: Field: snf3: Set As: $cwsize
    Local: Field: snf4: Set As: $cwproduct
    Local: Field: snf5: Set As: $cwproduct2
    Local: Field: snf6: Set As: $cwproduct3
    Local: Field: snf7: Set As: $cwproduct4
    Local: Field: nf: Set As: $Description
    Local: Field: numf: Set As: if $rateofvat = 0 then "0" else if $rateofvat = 5 then "1" else if $rateofvat = 14.5 then "2" else "  "
    Local: Field: numf2: Set As: $rateofmrp
    Local: Field: numf3: Set As: $rateofmrp
    Local: Field: numf4: Set As: @@cwcostprice
    Local: Field: nf2: Set As: ""
    local: field: numf2: format: "decimal:2,nozero"
    local: field: numf3: format: "decimal:2,nozero"
    local: field: numf4: format: "decimal:2,nozero"
    local: field: numf: type: String
    border: thin bottom

[System: Formula]
    cwcostprice: $$CollectionField:$rate:First:rate1colx

[collection: RAte1Colx]
    Type: Standard Cost List: StockItem
    Child of: $StockItemName
    fetch: rate

;------------------------------------------------------------------------------
; TOTALS LINE
;------------------------------------------------------------------------------

[line: LnShoperItemExplodeTotals]
    use: LnShoperItemExplode
    option: totalOpt
    local: field: fwf: align: right
    local: field: default: style: normal bold
    local: field: qtyf: set as: $$total:qtyf
    local: field: fwf: set as: "Total"
    local: field: fwf: set as: ""
    local: field: amtf: set as: $$total:amtf

;------------------------------------------------------------------------------
; FILTER BUTTON AND DIALOG
;------------------------------------------------------------------------------

[button: cwnewbutton]
    title: "Filter"
    key: f7
    action: modify variable: newfilterreport

[report: newfilterreport]
    title: ""
    form: newfilterform
    set: str1: ""
    Variable: str1

[form: newfilterform]
    part: newfilterpart

[part: newfilterpart]
    line: newfilterline

[line: newfilterline]
    field: nf, nf2
    Local: Field: nf: info: "Enter Part NO From"
    local: field: nf2: Modifies: str1

