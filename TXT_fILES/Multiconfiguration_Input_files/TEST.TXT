;===============================================================================
; TEST.TXT
; Created By: Pg on 2013-01-09 19:22, ID:
; Purpose: Utility for managing and reviewing Stock Item part numbers in Tally.
;          Provides a report with flexible sorting and a tool to clear all part numbers.
;===============================================================================

;------------------------------------------------------------------------------
; MENU AND BUTTON INTEGRATION
;------------------------------------------------------------------------------

[#menu : stock items] ;; Inventory Info.
    add : button : cwcheck, cwEmptyPArtNo

[Button : cwcheck]
    title : "Details..."
    key : f8
    action : display : reptest

[button : cwEmptyPArtNo]
    title : "Empty Part No"
    key : f9
    action : call : cwEmptyPartNo

;------------------------------------------------------------------------------
; VARIABLE FOR SORTING MODE
;------------------------------------------------------------------------------

[variable : num1x]
    type : number
    default : 1

[system:variable]
    num1x : 1

;------------------------------------------------------------------------------
; FUNCTION: CLEAR ALL PART NUMBERS (MAILINGNAME) FOR STOCK ITEMS
;------------------------------------------------------------------------------

[function : cwEmptyPartNo]
    01xx : QueryBox : "Clear All Part Nos?" : Yes : No
    02xx : do if : not $$lastresult : continue
    variable : myLastNo : number : @@cwnewno
    variable : totctr : number : $$numitems:MyNewItemsx

    05 : start progress : ##totctr : "Emptying Part Nos" : "" : "Please Wait ..."
    10 : walk collection : MyNewItemsx
    20 : modify object : (stockitem, $name).mailingname[1].mailingname : ""
    40 : show progress : $$loopindex
    100 : end walk
    120 : end progress

[collection : MyNewItemsx]
    use : stock item
    filter : cwhasmailingc

[System: Formula]
    cwhasmailingc : not $$isempty:$mailingname

;------------------------------------------------------------------------------
; REPORT: STOCK ITEM DETAILS WITH FLEXIBLE SORTING
;------------------------------------------------------------------------------

[Report: Reptest]
    use: Dsp Template
    Title: @@testReport
    Printset: Report Title: @@testReport
    Form: Frmtest
    Export: Yes
    Local: Button: RelReports: Inactive: Yes
    variable : num1x
    set : num1x : 1

[Form: Frmtest]
    use: DSP Template
    Part: DspAccTitles, PrtTitle0test, Prttest
    Width: 100% Page
    Height: 100% Page
    Background: @@SV_STOCKSUMMARY
    delete: page break
    add: page break: testbotbrk, testbotOpbrk
    Bottom Toolbar Buttons: BottomToolBarBtn1, BottomToolBarBtn3, BottomToolBarBtn8, BottomToolBarBtn9, BottomToolBarBtn10, BottomToolBarBtn11, BottomToolBarBtn12
    button : cwsortbyName, cwSortByPartNo, cwSortbyAlias

[button: cwsortbyName]
    key : f4
    title : "By Name"
    action : set : num1x : 1

[button: cwSortByPartNo]
    key : f5
    title : "By Part No"
    action : set : num1x : 2

[button: cwSortbyAlias]
    key : f6
    title : "By Alias"
    action : set : num1x : 3

;------------------------------------------------------------------------------
; DATA COLLECTION WITH SORTING
;------------------------------------------------------------------------------

[Collection: Coltest]
    use : newItemColl
    with alias : yes
    sort : @@Default : @@mysort

[system: Formula]
    mysort : if ##num1x = 1 then $name else if ##num1x = 2 then $mailingname else $$alias

;------------------------------------------------------------------------------
; REPORT LAYOUT: TITLE, DATA, TOTALS
;------------------------------------------------------------------------------

[Line: LntestTitle]
    use: Lntest
    option: titleopt
    local: field: qtyf: set as: "Qty."
    local: field: amtf: set as: "Value"
    local: field: ratepf : set as : "Rate"
    local: field: default : style: normal bold
    Local: Field: nf: Set As: "Name"
    Local: Field: nf2: Set As: "Part No"
    Local: Field: nf3: Set As: "Alias"

[Line: Lntest]
    field : nf, nf2, nf3
    Local: Field: nf: Set As: $name
    Local: Field: nf2: Set As: $mailingname
    Local: Field: nf3: Set As: $$alias
    option : alter on enter
    local : field : nf : alter : stockitem : $$isstockitem
    Local: field: default: Width: 100

[line: LntestTotals]
    use: Lntest
    option: totalOpt
    local: field: fwf: align: right
    local: field: default : style: normal bold
    local: field: qtyf: set as: $$total:qtyf
    local: field: fwf: set as: "Total"
    local: field: amtf : set as :  $$total:amtf

;===============================================================================
; END OF FILE
;===============================================================================
