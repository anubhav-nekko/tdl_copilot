;===============================================================================
; STOCKSUMMARYADDCUSTOMIZEDFIELDS.TXT
; Created By: pg on 2022-03-25 12:27, ID:
; Purpose: Adds custom item and batch fields to the Stock Summary report in Tally,
;          allowing display of up to 12 item-level and 3 batch-level custom fields,
;          with dynamic visibility and company-level captions.
;===============================================================================

;------------------------------------------------------------------------------
; EXTEND STOCK SUMMARY FORM WITH CUSTOM FIELD OPTIONS
;------------------------------------------------------------------------------

[#form: stock summary]
    add : option : cwShowBCinSS : @@cwShowItemsInStockSummary and $$cwSSCols < 3
    add : option : cwShowBCBInCSS : $cwshowbatchfieldinStockSummary:COMPANY:##SVCURRENTCOMPANY

;------------------------------------------------------------------------------
; FUNCTION: COUNT NUMBER OF SUMMARY COLUMNS (OPENING, IN, OUT, CLOSING)
;------------------------------------------------------------------------------

[function : cwSSCols]
    variable : ctr : number : 0

    10 : if : ##DSPShowOpening
    11 : incr : ctr
    12 : log : "opening"
    13 : end if

    20 : if : ##DSPShowInwards
    21 : incr : ctr
    22 : log : "inward"
    23 : end if

    30 : if : ##DSPShowOutwards
    31 : incr : ctr
    32 : log : "outward"
    33 : end if

    40 : if : ##DSPShowClosing
    41 : incr : ctr
    42 : log : "closing"
    43 : end if

    50 : log : ##ctr
    60 : return : ##ctr

;------------------------------------------------------------------------------
; ADD ITEM-LEVEL CUSTOM FIELDS TO STOCK SUMMARY LINES
;------------------------------------------------------------------------------

[!form: cwShowBCinSS]
    Local : Line : DSP AccLine : add : field : cwCF1, cwCF2, cwCF3, cwCF4, cwCF5, cwCF6, cwCF7, cwcf8, cwCF9, cwCF10, cwCF11, cwCF12

;------------------------------------------------------------------------------
; ADD BATCH-LEVEL CUSTOM FIELDS TO BATCH EXPLOSION LINES
;------------------------------------------------------------------------------

[!form : cwShowBCBInCSS]
    local: Part: SSITEM Explosion : local :line: default : add : field : cwBF1, cwBF2, cwBF3
    local: field : SSBatchName : width : 50

    local:line: DSP QtyTwoTitle:add:field:after:DSP NameTitle:cwCF0,cwBF1,cwBF2,cwBF3
    local:line: DSP QtyTwoTitle:Local: Field: cwBF1 : delete : invisible
    local:line: DSP QtyTwoTitle:Local: Field: cwBF1 : set as : $cwbatchcaption1:COMPANY:##SVCURRENTCOMPANY
    local:line: DSP QtyTwoTitle:Local: Field: cwBF2 : delete : invisible
    local:line: DSP QtyTwoTitle:Local: Field: cwBF2 : set as : $cwbatchcaption2:COMPANY:##SVCURRENTCOMPANY
    local:line: DSP QtyTwoTitle:Local: Field: cwBF3 : delete : invisible
    local:line: DSP QtyTwoTitle:Local: Field: cwBF3 : set as : $cwbatchcaption3:COMPANY:##SVCURRENTCOMPANY

;------------------------------------------------------------------------------
; FIELD DEFINITIONS FOR CUSTOM ITEM FIELDS (cwCF1–cwCF12)
;------------------------------------------------------------------------------

[field: cwCF0]
    use : snf
    style : tiny
    width : 10

[field: cwCF1]
    use : cwcf0
    set as : $cwsortno
    invisible : not $$isstockitem or $$issysname:$cwsortnoStr:COMPANY:##SVCURRENTCOMPANY

[field: cwCF2]
    use : cwcf0
    set as : $cwsize
    invisible : not $$isstockitem or $$issysname:$cwsizeStr:COMPANY:##SVCURRENTCOMPANY

[field: cwCF3]
    use : cwcf0
    set as : $cwproduct
    invisible : not $$isstockitem or $$issysname:$cwproductStr:COMPANY:##SVCURRENTCOMPANY

[field: cwCF4]
    use : cwcf0
    set as : $cwproduct2
    invisible : not $$isstockitem or $$issysname:$cwproductStr2:COMPANY:##SVCURRENTCOMPANY

[field: cwCF5]
    use : cwcf0
    set as : $cwproduct3
    invisible : not $$isstockitem or $$issysname:$cwproductStr3:COMPANY:##SVCURRENTCOMPANY

[field: cwCF6]
    use : cwcf0
    set as : $cwproduct4
    invisible : not $$isstockitem or $$issysname:$cwproductStr4:COMPANY:##SVCURRENTCOMPANY

[field: cwCF7]
    use : cwcf0
    set as : $cwproduct5
    ;; invisible : $$issysname:$cwproductStr5:COMPANY:##SVCURRENTCOMPANY

[field: cwcf8]
    use : cwcf0
    set as : $cwproduct10
    invisible : not $$isstockitem or $$issysname:$cwproductStr10:COMPANY:##SVCURRENTCOMPANY

[field: cwCF9]
    use : cwcf0
    set as : $cwproduct11
    invisible : not $$isstockitem or $$issysname:$cwproductStr11:COMPANY:##SVCURRENTCOMPANY

[field: cwCF10]
    use : cwcf0
    set as : $cwproduct12
    invisible : not $$isstockitem or $$issysname:$cwproductStr12:COMPANY:##SVCURRENTCOMPANY

[field: cwCF11]
    use : cwcf0
    set as : $cwproduct13
    invisible : not $$isstockitem or $$issysname:$cwproductStr13:COMPANY:##SVCURRENTCOMPANY

[field: cwCF12]
    use : cwcf0
    set as : $cwproduct14
    invisible : not $$isstockitem or $$issysname:$cwproductStr14:COMPANY:##SVCURRENTCOMPANY

;------------------------------------------------------------------------------
; FIELD DEFINITIONS FOR CUSTOM BATCH FIELDS (cwBF1–cwBF3)
;------------------------------------------------------------------------------

[field: cwBF1]
    use : cwcf0
    set as : $cwbatchcaption1

[field: cwBF2]
    use : cwcf0
    set as : $cwbatchcaption2

[field: cwBF3]
    use : cwcf0
    set as : $cwbatchcaption3

;===============================================================================
; END OF FILE
;===============================================================================
