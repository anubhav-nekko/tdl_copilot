; =============================================================================
;  INVOICE TITLE / PRINT-FORMAT CUSTOMISATION
;  ---------------------------------------------------------------------------
;  Original fragments : Khokan • 2021-04-13 17:08  and 2024-01-02 15:05
; =============================================================================



; ========================= 1. TITLE OUTPUT MEDIUM =============================
;  Adds extra options when Minu Saree feature is enabled (Sales / Cr-Note)
; -----------------------------------------------------------------------------
[#Part: Title Output Medium]

add:option:cwtitleoutputmiumopt      : @@issales      and @@MinuSareeEnabled
add:option:cwtitleoutputmiumcrnotopt : @@isCreditNote and @@MinuSareeEnabled



; ---- 1.1 Option for normal Sales voucher ------------------------------------
[!part:cwtitleoutputmiumopt]

add:line:titlelinenewp


[line:titlelinenewp]                             ; Caption row: “Title :”
field:medium prompt,snf,snf1,snf2
Local : Field : Medium Prompt : Info : $$LocaleString:"Title :"

; Display texts – can be replaced by variables (##PRNTYPE / ##str1 / ##str2)
Local: Field: snf : Set As:"Normal Invoice"
Local: Field: snf1: Set As:"F/N"          ;; Front-Note toggle
Local: Field: snf2: Set As:"Packingslip"
Local: Field: snf3: Set As:##PRNTYPE      ;; Hidden field (not declared here)

Local: Field: default: style:normal bold
local: field: snf1: Invisible:if @@cwenablefn="yes" then "no" else "yes"
space top:0.5
Local: Field: default: Color : blue



; ==================== 2. ALTERNATE TITLE (F/N enabled) =======================
[#Part: Title Output Medium]

;; {18.May.23 11:18} two more options when only F/N feature (no saree)
;; add:option:cwtitleoutputmiumopt2 : @@issales      and @@cwenablefn
;; add:option:cwtitleoutputmiumcrnotopt2 : @@isCreditNote and @@cwenablefn



[!part:cwtitleoutputmiumopt2]

add:line:titlelinenewp2x


[line:titlelinenewp2x]
field:medium prompt,snf,snf1,snf2
Local : Field : Medium Prompt : Info : $$LocaleString:"Title :"
Local : Field : snf : Set As:"Normal Invoice"
Local : Field : snf1: Set As:"F/N"
Local : Field : snf2: Set As:"Packingslip"
Local : Field : snf3: Set As:##PRNTYPE
Local : Field : default: style:normal bold
space top:0.5
Local : Field : default: Color : blue



; ========================= 3. STYLE DEFINITIONS ===============================
[style:style1xnew]                  ; Large, bold heading font
;; {18.Aug.21 14:52} font:"Calibri"
;; {18.Aug.21 14:55} font:"normal"
font:"Times New Roman"
height:20
bold:yes



; ===== 4. CREDIT-NOTE VARIANT OF TITLE =======================================
[!part:cwtitleoutputmiumcrnotopt]

add:line:titlelinenewp2


[line:titlelinenewp2]
field:medium prompt,snf2
Local : Field : Medium Prompt : Info : $$LocaleString:"Title :"
Local : Field : snf : Set As:"Packingslip"
Local : Field : snf1: Set As:"F/N"
Local : Field : snf2: Set As:"Normal Invoice"
Local : Field : default: Style: Normal Bold
space top:0.5
Local : Field : default: Color : blue



; ========================== 5. TOOLBAR BUTTON =================================
[#Form: VCHPRN Sales]
;; Add Ctrl + F8 button to switch print format (Normal / Packing Slip)
;; {13.Apr.21 18:11}
Add: BottomButton: At Beginning: salrepnew2



[KEY : salrepnew2]
 title :"Print Format"
 KEY   : CTRL+F8
 TITLE :"F/N"
 action: set : logi3



; ================= 6. SIMPLE / COMPREHENSIVE INVOICE OPTIONS ==================
[#form : Simple Printed Invoice]
;; {17.Aug.21 17:34} add option when transporter details required
;; add : option : fnsalesinvOpt:@@cwtransport



[#form : ComprehensiveInvoice]
;; {13.Apr.21 17:11}
Add : option : fnsalesinvOpt:@@cwtransport



; -------------------- Option form overriding original invoice -----------------
[!form : fnsalesinvOpt]

; Remove original framework …
Delete : Part
Delete : Bottom Part
Delete : Page Break

; …and insert F/N specific parts + page setup using user margins
add : Top part : fnsalesinvTopPart1,fnsalesinvTopPart,fnsalesinvTopPart2,fnsalesinvTopPart3,fnsalesinvInvACCPart,fnsalesinvBottomPart
add : Part     : fnsalesinvTopPart1XX,fnsalesinvTopPart1X,fnsalesinvTopPartX,fnsalesinvTopPart2X,fnsalesinvTopPart3X,fnsalesinvInvACCPartX,fnsalesinvBottomPartX
add : page Break : fnsalesinvCLBreak, fnsalesinvOPBreak

delete:Space Top : @@InvSmpSpace inch

add:space left :##spaceLeftnew  inch
add:space top  :##spacetopnew   inch
add:space right:##spaceRightnew inch
add:width      :##spacewidthnew inch
add:height     :##spaceHeightnew inch



; -------- Same override for second variant (cwfnsalesinvOptms) ---------------
[form : cwfnsalesinvOptms]
Delete : Part
Delete : Bottom Part
Delete : Page Break
add : Top part : fnsalesinvTopPart1,fnsalesinvTopPart,fnsalesinvTopPart2,fnsalesinvTopPart3,fnsalesinvInvACCPart,fnsalesinvBottomPart
add : Part     : fnsalesinvTopPart1XX,fnsalesinvTopPart1X,fnsalesinvTopPartX,fnsalesinvTopPart2X,fnsalesinvTopPart3X,fnsalesinvInvACCPartX,fnsalesinvBottomPartX
add : page Break : fnsalesinvCLBreak, fnsalesinvOPBreak
delete:Space Top : @@InvSmpSpace inch

add:space left :##spaceLeftnew  inch
add:space top  :##spacetopnew   inch
add:space right:##spaceRightnew inch
add:width      :##spacewidthnew inch
add:height     :##spaceHeightnew inch



; ======================= 7. WRAPPER PARTS (X variants) ========================
;  “XX / X” wrappers reuse existing parts but allow individual borders/heights.
; -----------------------------------------------------------------------------
[PART:fnsalesinvTopPart1XX]    ; Blank spacer
LINE:CWBLANKLINE
HEIGHT:10

[PART:fnsalesinvTopPart1X]     ; Direct re-use of original part
USE:fnsalesinvTopPart1

[PART:fnsalesinvTopPartX]      ; and so on…
USE:fnsalesinvTopPart
[PART:fnsalesinvTopPart2X]
USE:fnsalesinvTopPart2
[PART:fnsalesinvTopPart3X]
USE:fnsalesinvTopPart3
[PART:fnsalesinvInvACCPartX]
USE:fnsalesinvInvACCPart
[PART:fnsalesinvBottomPartX]
USE:fnsalesinvBottomPart



; ======================= 8. PAGE BREAK PLACEHOLDERS ===========================
[Part : fnsalesinvCLBreak]
use : fnsalesinvBottomPart

[Part : fnsalesinvOpBreak]
part : fnsalesinvTopPart



; ========================= 9. TOP-HEADER (F/N) ================================
[part:fnsalesinvTopPart1]
line:mstitlelinex
border:thin box



[line:mstitlelinex]
field:nf,fwfc,nf1,copyfield
Local: Field: fwfc: Set As:"F/NOTE"
Local: Field: nf1 : Set As:#copyfield
local: field: copyfield: Invisible: yes
Local: Field: fwfc: border:thin bottom
Local: Field: fwfc: Style: large Bold
HEIGHT:2
SPACE TOP:0.5



; ---------------------- Company name + address block --------------------------
[part : fnsalesinvTopPart]
part : fnsalesinvTopParta
part : fnsalesinvTopPartb
border:thin box
height:12



; ----- 9.1 Company details (name / address / GST) -----------------------------
[part : fnsalesinvTopPartA]
line:cmpfnline,cmpaddxline,gstcmpline
repeat:cmpaddxline:cwCompanyAddress

[Collection:cwCompanyAddress]
 Type        : Address   : Company
 Child of    : ##SVCurrentCompany
 Compute     : IsNumber        : No
 Compute     : FixedDirection  : No
 delete:Object : Company State, Company CINumber, Company Contacts, Company FaxNo, Company Email, Company Website
 Filter      : IsNotBlankAddr
 delete:Option : Company GSTINumber : (##IsVoucher OR ##IsMultiVchReport) AND @@IsGSTOnAppl
 delete:Option : Company TINTRNNumber: (##IsVoucher OR ##IsMultiVchReport) AND @@IsVChGVATApplicable



[LINE:cmpfnline]
 field:fwf
 Local: Field: fwf: Set As:@@cmpmailname
 Local: Field: default: Style: large Bold
 space top:0.5



[line:cmpaddxline]
 field:fwf
 Local: Field: fwf: Set As:$address
 space top:0.5



[line:gstcmpline]
 field:sp,nf,sp2,nf2
 Local: Field: sp : Set As:"GSTIN :"
 Local: Field: nf : Set As:@@VATCMPGSTNumber
 Local: Field: sp2: Set As:"Phone :"
 Local: Field: nf2: Set As:@@cwCmpMobile
 Local: field: sp  : Width:8
 Local: field: sp2 : Width:7
 space top:0.5



; ----- 9.2 Date / From / To block --------------------------------------------
[part : fnsalesinvTopPartB]
 line:dtline,fromline,toline

[line:dtline]
 field:sp,sdf
 Local: Field: sp : Set As:"Date"
 Local: Field: sdf: Set As:@@cwshortmfdm
 local: field: sdf: type: String
 Local: field: sdf: Align:left
 Local: field: sp : Width:8
 Local: field: sdf: Width:20
 space top:0.5



[line:fromline]
 field:sp,snf
 Local: Field: sp : Set As:"From"
 Local: Field: snf: Set As:$cwfromfn
 Local: field: sp : Width:8
 Local: field: snf: Width:20
 space top:0.5



[line:toline]
 field:sp,snf
 Local: Field: sp : Set As:"To"
 Local: Field: snf: Set As:$cwtofn
 Local: field: sp : Width:8
 Local: field: snf: Width:20
 space top:0.5



; ===================== 10. TRANSPORTER / CONSIGNEE BOXES ======================
;  10.1 Transporter (left), 10.2 Consignee (right)
; -----------------------------------------------------------------------------
[part:fnsalesinvTopPart2]
 part:fnsalesinvTopPart2a,fnsalesinvTopPart2b
 border:thin box
 height:10



; ---- 10.1 Transporter details -----------------------------------------------
[part:fnsalesinvTopPart2a]
 line:transline,transline1,traddline,trphline,gsttrline
 repeat:traddline:colllcwTRANSPORTER

[collection: colllcwTRANSPORTER]
 type : address : ledger
 child of : $cwtempGSTewayTransporterName



[line:transline]
 field:fwf
 Local: Field: fwf: Set As:"TRANSPORTER"
 border:thin bottom
 space top:0.5
 HEIGHT:1.5



[line:transline1]
 field:snfx,fwf
 Local: Field: snfx: Set As:"To ,"
 Local: Field: fwf: Set As:if $$issysname:$cwtempGSTewayTransporterName then "" else $cwtempGSTewayTransporterName
 Local: Field: fwf: Style: Normal Bold
 Local: field: snfx: Width:3
 space top:0.5



[line:traddline]
 field:fwf
 Local: Field: fwf: Set As:$address



[line:traddline2]
 field:fwf
 Local: Field: fwf: Set As:$cwTransporteradd2



[line:trnmacontpersline1x]
 field:fwf
 Local: Field: fwf: set as:"Contact Person :"+$cwTransportercontperson
 space top:0.5



[line:trphline]
 field:fwf
 Local: Field: fwf: Set As:if $$isempty:@@cwtrphno then "" else "Ph :"+$LedgerPhone:ledger:$cwtempGSTewayTransporterName+" "+$LedgerMobile:ledger:$cwtempGSTewayTransporterName
 space top:0.5



[System: Formula]
 cwtrphno:$LedgerMobile:ledger:$cwtempGSTewayTransporterName



[line:gsttrline]
 field:nf,nf2
 Local: Field: NF : Set As:$cwledcity:ledger:$cwtempGSTewayTransporterName +" "+$PinCode:LEDGER:$cwtempGSTewayTransporterName+" "+@@cwconLedStateNamenew
 Local: Field: NF2: Set As:if $$isempty:($PartyGSTIN:ledger:$cwtempGSTewayTransporterName) then "" else "GSTIN : "+$PartyGSTIN:ledger:$cwtempGSTewayTransporterName
 Local: field: NF : Width:40
 Local: Field: NF2: Style: Normal Bold
 space top:0.5



[System: Formula]
 cwconLedStateNamenew : if $$issysname:@@cwconLedStateNamenew2 then "" else @@cwconLedStateNamenew2
 cwconLedStateNamenew2:$LedStateName:ledger:$cwtempGSTewayTransporterName



; ---- 10.2 Consignee details --------------------------------------------------
[part:fnsalesinvTopPart2b]
 line:consline,consnameline,consaddline,CONSphline,gstconsline
 Repeat: consaddline : BASICBUYERADDRESS
 BORDER:THIN LEFT



[line:consline]
 field:fwf
 Local: Field: fwf: Set As:"CONSIGNEE"
 BORDER:THIN BOTTOM
 space top:0.5
 HEIGHT:1.5



[line:consnameline]
 field:fwf
 Local: Field: fwf: Set As:@@cwmstitle+" "+$CONSIGNEEMAILINGNAME
 Local: Field: FWF: Style: Normal Bold
 space top:0.5



[System: Formula]
 cwmstitle:$cwmstitle:COMPANY:##SVCURRENTCOMPANY



[line:consaddline]
 field:fwf
 Local: Field: fwf: Set As:$BASICBUYERADDRESS



[line:CONSphline]
 field:fwf
 Local: Field: fwf: Set As:if $$isempty:($LedgerMobile:ledger:$BASICBUYERNAME) then "" else "Ph :"+$LedgerPhone:ledger:$BASICBUYERNAME+" "+$LedgerMobile:ledger:$BASICBUYERNAME
 space top:0.5



[line:gstconsline]
 field:nf,nf2
 Local: Field: NF : Set As:$cwledcity:ledger:$BASICBUYERNAME +" "+$Consigneepincode+" "+$CONSIGNEESTATENAME
 Local: Field: NF2: Set As:if $$isempty:$CONSIGNEEGSTIN then "" else "GSTIN : "+$CONSIGNEEGSTIN
 Local: field: NF : Width:40
 Local: Field: NF2: Style: Normal Bold
 space top:0.5



; ======================== 11. TERMS / INSTRUCTIONS BOX ========================
[part:fnsalesinvTopPart3]
 line:plesline,plesline1
 Border: thin box
 height:3



[line:plesline]
 field:fwf,nf
 Local: Field: fwf: Set As:"Please receive the undermentioned consignment and forward  by roade to"
 Local: Field: nf : Border: thin bottom
 Local: field: nf: Width:55



[line:plesline1]
 field:fwf
 Local: Field: fwf: Set As:"station as per particulars give below"



; ======================= 12. INVENTORY & ACCOUNTS =============================
;  Inv Part (packages & instructions) + Acc Part (ledger charges)
; -----------------------------------------------------------------------------
[part : fnsalesinvINVACCPart]
Parts       : fnsalesinvInvPart
CommonBorder: Yes
Vertical    : Yes
Float       : No
border      : thin box
HEIGHT      : 6



; ---------- 12.1 Inventory table ---------------------------------------------
[part : fnsalesinvInvPart]
 line : fnsalesinvInvLineTitle,fnsalesinvInvLine
 Common border : yes
 float : no



[Line : fnsalesinvInvLine]
 field : snf,snf2,nf,numf,fwf
 local: field : snf  : set as :$cwnofobales
 local: field : snf2 : set as :$cwNatureOfGoods
 local: field : nf   : set as :$cwPrivateMarks
 local: field : numf : set as :$cwValueofInsurance
 local: field : fwf  : set as :$cwSpecialInstructions
local : field : numf : type : string
local : field : ratef: type : number
local : field : ratef: align: right
local : field : numf : format :"Decimals:2,NoZero"
Local : Field : default : Border: thin right
Local : Field : fwf : delete : Border: thin right



[line: fnsalesinvInvLineTitle]
 use : fnsalesinvInvLine
delete : explode
local : field: default : type : string
local : field : snf  : set as : "No of Packages"
local : field : snf2 : set as : "Nature of Goods"
local : field : nf   : set as : "Private Marks"
local : field : numf : set as : "Value Insur"
local : field : fwf  : set as : "Special Instructions"
border:thin bottom
Local : field : default: Lines : 0
Local : field : default: Align:centre



; ---------- 12.2 Ledger charges table ----------------------------------------
[part : fnsalesinvACCPart]
 line : fnsalesinvACCLine
repeat : fnsalesinvACCLine : Ledger Entries
Scroll : vertical
Common border : yes
 float : no



[Line : fnsalesinvACCLine]
   use : fnsalesinvINVLINE
empty : $ledgername = $partyledgername or $$issysname:$ledgername or $$isempty:$amount
local : field : ratef : type : number
local : field : ratef : align : right
local : field : ratef : format :"NoZero,Percentage"
local : field : ratef  : set as : $basicrateofinvoicetax
local : field : snf : set as : ""
local : field : fwf : set as : $ledgername
local : field : qtyf : set as : ""
delete : explode



; ========================== 13. FOOTER REMARKS ================================
[part : fnsalesinvBottomPart]
 line : fnsalesinvTotLine



[line : fnsalesinvTotLine]
 field:fwf
 Local: Field: fwf: Set As:"Remaks : " +$narration
 Local: Field: fwf: Style: Normal Bold
 Local: field: fwf: Lines :4



; =============================================================================
;  END OF FILE – Invoice Print-Format Overrides
; =============================================================================