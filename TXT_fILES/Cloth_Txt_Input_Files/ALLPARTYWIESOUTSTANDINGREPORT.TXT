;===============================================================================
; ALLPARTYWIESOUTSTANDINGREPORT.TXT
; Created By: Khokan on 2021-08-27 10:32, ID:
; Purpose: Provides an "All Party Wise Outstanding Report" in Tally,
;          showing outstanding bills and credits for all parties, with filtering,
;          split view, and totals.
;===============================================================================

;------------------------------------------------------------------------------
; MENU INTEGRATION: Add report option to Gateway of Tally and Debug menu
;------------------------------------------------------------------------------

[#menu: Gateway of Tally]
;; {27.Aug.21 13:31}         add: Option: AllpartywiesoutstandingreportLock ;; : @@AllpartywiesoutstandingreportDemoLock

[#menu : cw_Debug_menu]
    add: Item: before: @@locQuit: @@AllpartywiesoutstandingreportReport: Display: RepAllpartywiesoutstandingreport

[!menu: AllpartywiesoutstandingreportLock]
    add: Item: before: @@locQuit: @@AllpartywiesoutstandingreportReport: Display: RepAllpartywiesoutstandingreport
    add: Item: before: @@locQuit: Blank

;------------------------------------------------------------------------------
; SYSTEM FORMULA: Report title (and optional demo lock)
;------------------------------------------------------------------------------

[System: formula]
    AllpartywiesoutstandingreportReport: "All Party wise outstanding report"
;; AllpartywiesoutstandingreportDemoLock: $$MachineDate < $$Date:"01/04/2013"

;------------------------------------------------------------------------------
; MAIN REPORT DEFINITION: All Party Wise Outstanding Report
;------------------------------------------------------------------------------

[Report: RepAllpartywiesoutstandingreport]
    use: Dsp Template
    Title: @@AllpartywiesoutstandingreportReport
    Printset: Report Title: @@AllpartywiesoutstandingreportReport
    Form: FrmAllpartywiesoutstandingreport
    Export: Yes
    ;;  set  : svfromdate : ##svcurrentdate
    set  : svTodate : ##svcurrentdate
    Local: Button: RelReports: Inactive: Yes
    variable: str1
    set: str1: ""

;------------------------------------------------------------------------------
; MAIN FORM LAYOUT AND TOOLBAR BUTTONS
;------------------------------------------------------------------------------

[Form: FrmAllpartywiesoutstandingreport]
    use: DSP Template
    Part: DspAccTitles,PrtTitle0Allpartywiesoutstandingreport,PrtAllpartywiesoutstandingreport,PrtAllpartywiesoutstandingreport2
    Width: 100% Page
    Height: 100% Page
    Background: @@SV_STOCKSUMMARY
    delete: page break
    add: page break: Allpartywiesoutstandingreportbotbrk,AllpartywiesoutstandingreportbotOpbrk
    Bottom Toolbar Buttons: BottomToolBarBtn1, BottomToolBarBtn3, BottomToolBarBtn8, BottomToolBarBtn9, BottomToolBarBtn10, BottomToolBarBtn11,BottomToolBarBtn12
    add: button: agentbotton
    local:Part:DSPCompanyName:local:line:DSPCompanyName: Local: Field: DSP CompanyName:PrintStyle:styleCalisto2
    local:Part:DSPCompanyAddress:local:line:DSPCompanyAddress: Local: Field: DSPCompanyAddress:PrintStyle:style2n
    local:Part:DSPReportTitle:local:line:DSPReportName: Local: Field: DSPReportName:PrintStyle:style3n
    local:Part:DSPReportSubTitle:local:line:DSPReportSubTitle: Local: Field: DSPReportSubTitle:PrintStyle:style2n
    local:Part:DSPReportTitle:local:line:DSPReportPeriod:Local: Field: DSPReportPeriod:PrintStyle:style2n
    local:Part:DSPPageNo:local:line:DSPPageNo: Local: Field:DSPPageNo:PrintStyle:style2n

;------------------------------------------------------------------------------
; PAGE BREAK AND TITLE PARTS
;------------------------------------------------------------------------------

[part: AllpartywiesoutstandingreportbotBrk]
    line: EXPINV PageBreak
    border: thin top

[part: Allpartywiesoutstandingreportbotopbrk]
    use: dspacctitles
    add: part: AllpartywiesoutstandingreportTitlePart

[part: AllpartywiesoutstandingreportTitlePart]
    part: AllpartywiesoutstandingreportTitleParta
    part: AllpartywiesoutstandingreportTitlePartb

[part: AllpartywiesoutstandingreportTitleParta]
    line: LnAllpartywiesoutstandingreportTitle

[part: AllpartywiesoutstandingreportTitlePartb]
    line: LnAllpartywiesoutstandingreportTitleb

[line: LnAllpartywiesoutstandingreportCurrPeriod]
    field: fwf,fwf2
    Local: field: fwf2: Align: Right
    Local: Field: fwf: Style: normal bold
    Local: Field: fwf2: Style: normal bold
    Local: Field: fwf2: Set As: @@dspDateStr
    Local: Field: fwf2: Style: styleCalisto
    Local: Field: fwf: Style: styleCalisto
    Local: Field: fwf2: invisible: $$inprintmode

[part: PrtTitle0Allpartywiesoutstandingreport]
    line : LnAllpartywiesoutstandingreportCurrPeriod

;------------------------------------------------------------------------------
; MAIN DATA PART: Outstanding Bills (Debit Side)
;------------------------------------------------------------------------------

[Part: PrtAllpartywiesoutstandingreport]
    Part: PrtAllpartywiesoutstandingreporta
    Part: PrtAllpartywiesoutstandingreportb

[Part: PrtAllpartywiesoutstandingreporta]
    Line: LnAllpartywiesoutstandingreportTitle, LnAllpartywiesoutstandingreport
    repeat: LnAllpartywiesoutstandingreport: ColAllpartywiesoutstandingreport
    scroll: Vertical
    Common Border: Yes
    Total: Qtyf, amtf
    Width: 50  ;;% page

[Collection: ColAllpartywiesoutstandingreport]
    type: bills
    filter: ColAllpartywiesoutstandingreportFilter, cwparentagfilter
    fetch: ledgerentries.ledgerentries.cwnetsales

[system: Formula]
    ColAllpartywiesoutstandingreportFilter: $$isdr:$closingbalance

[Line: LnAllpartywiesoutstandingreportTitle]
    use: LnAllpartywiesoutstandingreport
    option: titleopt
    local: field: sdf: set as: "Date"
    local: field: snf: set as: "Bill No"
    local: field: fwf: set as: "Party Name"
    local: field: amtf: set as: "Dr. Amount"
    local: field: numf: set as: "Due Days"
    local: field: numf: style: styleCalisto2
    local: field: sdf: style: styleCalisto2
    local: field: fwf: style: styleCalisto2
    local: field: amtf: style: styleCalisto2
    local: field: snf: style: styleCalisto2
    Local: field: DEFAULT: Align: centre
    Local: field: FWF: Align: LEFT

[Line: LnAllpartywiesoutstandingreport]
    Fields: sdf, snf, fwf
    right field: numf, Amtf
    Option: Alter on Enter
    local: field: qtyf: Format: "NoSymbol, Short Form, No Compact,NoZero"
    local: field: ratepf: setas: #amtf/#qtyf
    local: field: fwf: alter: voucher: $$isvoucher
    option: alter on enter
    local: field: fwf: alter: voucher: $$isvoucher
    local: field: sdf: set as: $billdate
    local: field: snf: set as: $name
    local: field: fwf: set as: $parent
    local: field: amtf: set as: $closingbalance
    local: field: numf: set as: @@DSPToDate - $BillDate
    Local: Field: DEFAULT: Border: thin right
    Local: Field: sdf: Border: thin left right
    local: field: DEFAULT: style: styleCalisto
    Local: field: snf: Width: 10
    Local: field: numf: Width: 12
    border: thin bottom

;------------------------------------------------------------------------------
; TOTALS LINES: Outstanding Dr. Total and Net O/S
;------------------------------------------------------------------------------

[part: PrtAllpartywiesoutstandingreport2]
    part: PrtAllpartywiesoutstandingreport2a
    part: PrtAllpartywiesoutstandingreport2b

[part: PrtAllpartywiesoutstandingreport2a]
    line: LnAllpartywiesoutstandingreportTotals, LnoutstandingreportTotalsnettolatx
    Width: 50  ;;% page

[line: LnAllpartywiesoutstandingreportTotals]
    use: LnAllpartywiesoutstandingreport
    option: totalOpt
    local: field: fwf: align: right
    local: field: default: style: normal bold
    local: field: qtyf: set as: $$total:qtyf
    local: field: fwf: set as: "Dr.Total"
    local: field: amtf: set as: $$CollAmtTotal:ColAllpartywiesoutstandingreport:$closingbalance
    local: field: sdf: style: styleCalisto2
    local: field: fwf: style: styleCalisto2
    local: field: amtf: style: styleCalisto2

[line: LnoutstandingreportTotalsnettolatx]
    use: LnAllpartywiesoutstandingreport
    option: totalOpt
    local: field: fwf: align: right
    local: field: default: style: normal bold
    local: field: qtyf: set as: $$total:qtyf
    local: field: fwf: set as: "NET O/S"
    local: field: amtf: set as: $$CollAmtTotal:ColAllpartywiesoutstandingreport:$closingbalance - $$CollAmtTotal:ColAllpartywiesoutstandingreportb:$closingbalance
    Local: field: amtf: Format: "drcr"
    local: field: sdf: style: styleCalisto2
    local: field: fwf: style: styleCalisto2
    local: field: amtf: style: styleCalisto2

;------------------------------------------------------------------------------
; MAIN DATA PART: Outstanding Credits (Credit Side)
;------------------------------------------------------------------------------

[Part: PrtAllpartywiesoutstandingreportb]
    Line: LnAllpartywiesoutstandingreportTitleb, LnAllpartywiesoutstandingreportb
    repeat: LnAllpartywiesoutstandingreportb: ColAllpartywiesoutstandingreportb
    scroll: Vertical
    Common Border: Yes
    Total: Qtyf, amtf
    Width: 50  ;;% page

[Collection: ColAllpartywiesoutstandingreportb]
    type: bills
    filter: ColAllpartywiesoutstandingreportFilterb, cwparentagfilter
    fetch: ledgerentries.ledgerentries.cwnetsales

[system: Formula]
    ColAllpartywiesoutstandingreportFilterb: not $$isdr:$closingbalance

[Line: LnAllpartywiesoutstandingreportTitleb]
    use: LnAllpartywiesoutstandingreportb
    option: titleopt
    local: field: sdf: set as: "Date"
    local: field: fwf: set as: "Particulars"
    local: field: amtf: set as: "Cr. Amount"
    local: field: snf: set as: "Mode of credit"
    local: field: snf: style: styleCalisto2
    Local: field: FWF: Align: LEFT
    local: field: default: style: normal bold
    Local: field: DEFAULT: Align: centre
    local: field: sdf: style: styleCalisto2
    local: field: fwf: style: styleCalisto2
    local: field: amtf: style: styleCalisto2
    Local: field: snf: Lines: 0

[Line: LnAllpartywiesoutstandingreportb]
    Fields: sdf, snf, fwf
    right field: Amtf
    Option: Alter on Enter
    local: field: qtyf: Format: "NoSymbol, Short Form, No Compact,NoZero"
    local: field: ratepf: setas: #amtf/#qtyf
    local: field: fwf: alter: voucher: $$isvoucher
    option: alter on enter
    local: field: fwf: alter: voucher: $$isvoucher
    local: field: sdf: set as: $billdate
    local: field: fwf: set as: $name
    local: field: amtf: set as: $closingbalance
    local: field: snf: set as: if @@cwrecvchtype = "Receipt" then (if not $$isempty:@@cwTransactionTypec then @@cwTransactionTypec else "Cash") else @@cwModeofcredit
    Local: Field: DEFAULT: Border: thin right
    local: field: DEFAULT: style: styleCalisto
    Local: field: snf: Width: 10
    border: thin bottom

;------------------------------------------------------------------------------
; CREDIT TOTALS LINE
;------------------------------------------------------------------------------

[part: PrtAllpartywiesoutstandingreport2b]
    line: LnAllpartywiesoutstandingreportTotalsb
    Width: 50% page

[line: LnAllpartywiesoutstandingreportTotalsb]
    use: LnAllpartywiesoutstandingreportb
    option: totalOpt
    local: field: fwf: align: right
    local: field: default: style: normal bold
    local: field: qtyf: set as: $$total:qtyf
    local: field: fwf: set as: "Cr.Total"
    local: field: snf: set as: ""
    local: field: sdf: style: styleCalisto2
    local: field: fwf: style: styleCalisto2
    local: field: amtf: style: styleCalisto2
    local: field: amtf: set as: $$CollAmtTotal:ColAllpartywiesoutstandingreportb:$closingbalance
