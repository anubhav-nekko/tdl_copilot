;===============================================================================
;  Party-Ledger Creation Enhancements (Mailing-Name + PAN)                      ;
;  --------------------------------------------------------------------------  ;
;  • Original Author : Khokan (24-Mar-2021)                                     ;
;  • Toggle Formula  : @@cwenicforparty (set at Company level)                  ;
;  • What it Does    :                                                          ;
;       – Inserts “Party Ledger Creation ?” logical flag in Ledger master.      ;
;       – Allows entry of custom Mailing-Name & PAN/IT No. when flag = YES.     ;
;       – Auto-fills master Name and Mailing/IT fields during creation.         ;
;       – Adds “City :” prompt in multi-address section (India only).           ;
;-------------------------------------------------------------------------------;

;--------------------------- COMPANY-LEVEL FORMULA -----------------------------;
;  Makes the logical variable accessible in subsequent add:option statements.  ;
;-------------------------------------------------------------------------------;
; Created By: Khokan on 2021-03-24 14:17, ID:
[System: Formula]
cwenicforparty : $cwenicforparty:COMPANY:##SVCURRENTCOMPANY



;===============================================================================
; 1.  Extend the default “Ledger” form                                           ;
;===============================================================================;
[#Form: Ledger]
add:option:newledopt:@@cwenicforparty        ;<– attach only when feature ON

[!form:newledopt]                            ;<< injected overlay form
add:part:at beginning:partyledcrline         ;<– insert new part at very top

;  – Override Name field to use computed cwledname (see formula block below)   ;
local:field:mst name : set as     : @@cwledname
local:field:mst name : set always : yes
local:field:mst name : width      : 60



;===============================================================================
; 1.1  PART containing flag line + Mailing / PAN input line                      ;
;===============================================================================;
[part:partyledcrline]
LINE:partyledcrline,panlinenew               ; two lines in this part



;------------------------ 1.1.1  Flag “Party Ledger Creation ?” ---------------;
[LINE:partyledcrline]
field:sp,cwlogical
Local: Field: sp       : Set As : "Party Ledger Creation ?"
Local: Field: cwlogical: storage : cwiscustname
Local: Field: default  : Style : Normal Bold
Local: field: sp       : Width : 20



;------------------------ 1.1.2  Mailing & PAN entry line ---------------------;
[line:panlinenew]
field:sp,maillingfield,sp2,Ledpanfield
Local: Field: sp  : Set As : "Mailling Name"
Local: Field: sp2 : Set As : "PAN/IT No."

Local: field: sp  : Width : 15
Local: field: sp2 : Width : 15

;  – The entire line is inactive unless cwiscustname = "yes" ------------------;
local: field: default : inactive : if $cwiscustname = "yes" then "no" else "yes"



;------------------------ 1.1.2.a  Mailing-Name Field -------------------------;
[field:maillingfield]
use        : nf
set always : yes
storage    : cwmaillingname
Style      : Normal Bold
width      : 40



;------------------------ 1.1.2.b  PAN / IT-No. Field -------------------------;
[field:Ledpanfield]
use        : nf
set always : yes
storage    : cwledpanno
Style      : Normal Bold



;===============================================================================
; 1.2  Helper Formulae to auto-compose the Ledger Name                           ;
;===============================================================================;
[System: Formula]
cwledname : if @@cwledname1 = " " then $$value else @@cwledname1

;; {24.Mar.21 14:30}  cwledname1:@@xs1+" - "+@@xs2
cwledname1 : @@xs1 + "" + @@xs2
xs1        : if not $$isempty:#maillingfield then #maillingfield else ""
xs2        : if not $$isempty:#Ledpanfield   then #Ledpanfield   else ""



;===============================================================================
; 2.  Override FIELD behaviour at run-time (Mailing-Name & IT No.)               ;
;===============================================================================;

[#Field: LED Mailing Name]
add:option:LEDMailingNameopt:@@cwenicforparty

[!field:LEDMailingNameopt]
set as : if not $$isempty:#maillingfield then #maillingfield else $name



[#Field: LED ITNo]
add:option:LEDitnoopt:@@cwenicforparty

[!field:LEDitnoopt]
set as     : if not $$isempty:#Ledpanfield then #Ledpanfield else $$value
set always : yes



;;=====================================================================
; 3.  Add “City :” prompt inside Address block (single / multi)         ;
;=====================================================================;

[#Part: LED AddrTypeStatePinCode]
add : line : before : LED AddrTypePinCode : cwLEDAddrTypeCity

;-------------------------- 3.1  Single-Address City --------------------------;
[line : cwLEDAddrTypeCity]
Field         : Medium Prompt, snf
Local         : Field : Medium Prompt       : Set as : $$LocaleString:"City :"
Local         : Field : Medium Prompt       : Width  : @@NameWidth
Local         : Field : Default             : Inactive : NOT $$LocaleString:$CountryName = $$LocaleString:"India"
;; {22.Apr.21 13:40} Local: Field: snf: storage: cwPartyAddressCity
Local         : Field : snf                 : storage : cwPartymultiAddressCity
Local         : Field : snf                 : Style   : Normal Bold



;===============================================================================
; 3.a  (COMMENTED) Alternative multi-address patch for Minu Saree add-on        ;
;       – kept verbatim but inactive                                            ;
;===============================================================================;
        /*
[#Part: LED AddrTypeStatePinCode]
 add:option:ledAddrTypeStatePinCodeopt:@@MinuSareeEnabled
 [!part:ledAddrTypeStatePinCodeopt]

add : line : before : LED AddrTypePinCode: cwLEDmuliAddrTypeCity

[line : cwLEDmuliAddrTypeCity]
Field		: Medium Prompt, snf,snf8
Local: Field: snf8: storage:cwnewcityled
Local		: Field : Medium Prompt		: Set as	: $$LocaleString:"City :"
Local		: Field : Medium Prompt 	: Width	 	: @@NameWidth

Local: Field: snf: storage: cwPartymultiAddressCity
Local: Field: snf: Style: Normal Bold
        */



;=====================================================================
;                            END OF FILE                             ;
;=====================================================================