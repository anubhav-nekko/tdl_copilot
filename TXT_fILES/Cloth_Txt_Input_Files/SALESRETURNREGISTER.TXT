;===============================================================================
; SALESRETURNREGISTER.TXT
; Created By: Khokan
; Purpose: Implements a "Sales Return Register" report in Tally, showing all
;          credit note (sales return) vouchers with item-wise breakup, agent,
;          salesman, area, and running totals for fresh and kata/seconds returns.
;===============================================================================

;;------------------------------------------------------------------------------
;; MENU INTEGRATION: Add report option to Gateway of Tally and Debug menu
;;------------------------------------------------------------------------------

[#Menu: Gateway of Tally]
    Add: Item: Before: @@locQuit: "Sales Return Register": Display: RepSalesReturnRegister

[#Menu: cw_Debug_menu]
    Add: Item: Before: @@locQuit: "Sales Return Register": Display: RepSalesReturnRegister

;;------------------------------------------------------------------------------
;; MAIN REPORT DEFINITION
;;------------------------------------------------------------------------------

[Report: RepSalesReturnRegister]
    Use        : DSP Template
    Title      : "Sales Return Register"
    PrintSet   : Report Title: "Sales Return Register"
    Form       : FrmSalesReturnRegister
    Export     : Yes
    Set        : SVFromDate : ##SVCurrentDate
    Set        : SVToDate   : ##SVCurrentDate
    Local      : Button: RelReports: Inactive: Yes

;;------------------------------------------------------------------------------
;; MAIN FORM LAYOUT
;;------------------------------------------------------------------------------

[Form: FrmSalesReturnRegister]
    Use     : DSP Template
    Part    : DspAccTitles, PrtTitle0SalesReturnRegister, PrtSalesReturnRegister
    Width   : 100% Page
    Height  : 100% Page
    Background: @@SV_STOCKSUMMARY
    Delete  : Page Break
    Add     : Page Break: SalesReturnRegisterBotBrk, SalesReturnRegisterBotOpBrk
    Bottom Toolbar Buttons: BottomToolBarBtn1, BottomToolBarBtn3, BottomToolBarBtn8, BottomToolBarBtn9, BottomToolBarBtn10, BottomToolBarBtn11, BottomToolBarBtn12

[Part: SalesReturnRegisterBotBrk]
    Line: EXPINV PageBreak
    Border: Thin Top

[Part: SalesReturnRegisterBotOpBrk]
    Use: dspacctitles
    Add: Part: SalesReturnRegisterTitlePart

[Part: SalesReturnRegisterTitlePart]
    Line: LnSalesReturnRegisterTitle

[Line: LnSalesReturnRegisterCurrPeriod]
    Field: fwf, fwf2
    Local: Field: fwf2: Align: Right
    Local: Field: fwf: Style: Normal Bold
    Local: Field: fwf2: Style: Normal Bold
    Local: Field: fwf2: Set As: @@dspDateStr
    Invisible: $$inprintmode

[Part: PrtTitle0SalesReturnRegister]
    Line: LnSalesReturnRegisterCurrPeriod

;;------------------------------------------------------------------------------
;; MAIN DATA PART: Table of sales return details
;;------------------------------------------------------------------------------

[Part: PrtSalesReturnRegister]
    Line: LnSalesReturnRegisterTitle, LnSalesReturnRegister
    Bottom Line: LnSalesReturnRegisterTotals
    Repeat: LnSalesReturnRegister: ColSalesReturnRegister
    Scroll: Vertical
    Common Border: Yes
    Total: Qtyf, Qtyf2, Amtf

;;------------------------------------------------------------------------------
;; DATA COLLECTION: Aggregates sales return vouchers with inventory details
;;------------------------------------------------------------------------------

[Collection: ColSalesReturnRegister]
    Type: Vouchers: VoucherType
    Child Of: $$VchTypeCreditNote
    Belongs To: Yes
    Walk: InventoryEntries
    By: StockItemName: $StockItemName
    By: PartyLedgerName: $PartyLedgerName
    Aggr Compute: FreshReturnQty: Sum: If $BatchName = "Fresh" Then $BilledQty Else $$InitValue:"Number"
    Aggr Compute: KataReturnQty: Sum: If $BatchName = "Kata" Then $BilledQty Else $$InitValue:"Number"
    Aggr Compute: ReturnValue: Sum: $Amount
    Fetch: PartyLedgerName, StockItemName, BatchName, BilledQty, Amount, Agent, Salesman, Area

;;------------------------------------------------------------------------------
;; HEADER LINE: Column titles for the report
;;------------------------------------------------------------------------------

[Line: LnSalesReturnRegisterTitle]
    Use: LnSalesReturnRegister
    Option: TitleOpt
    Local: Field: sdf: Set As: "Product"
    Local: Field: fwf: Set As: "Description"
    Local: Field: qtyf: Set As: "Fresh Rtn Qty."
    Local: Field: qtyf2: Set As: "Kata/Seconds Rtn Qty."
    Local: Field: amtf: Set As: "Rtn Value"
    Local: Field: nf: Set As: "Agent"
    Local: Field: snf: Set As: "SalesMan"
    Local: Field: snf2: Set As: "Area"
    Local: Field: default: Align: Centre
    Local: Field: fwf: Align: Left
    Local: Field: default: Style: Normal Bold

;;------------------------------------------------------------------------------
;; DATA LINE: Main line showing all calculated columns per item/party
;;------------------------------------------------------------------------------

[Line: LnSalesReturnRegister]
    Fields: sdf, fwf, qtyf, qtyf2, amtf, nf, snf, snf2
    Option: Alter on Enter
    Local: Field: sdf: Set As: $StockItemName
    Local: Field: fwf: Set As: $StockItemName
    Local: Field: qtyf: Set As: $FreshReturnQty
    Local: Field: qtyf2: Set As: $KataReturnQty
    Local: Field: amtf: Set As: $ReturnValue
    Local: Field: nf: Set As: $Agent
    Local: Field: snf: Set As: $Salesman
    Local: Field: snf2: Set As: $Area
    Local: Field: default: Border: Thin Right

;;------------------------------------------------------------------------------
;; TOTALS LINE: Running totals for all columns
;;------------------------------------------------------------------------------

[Line: LnSalesReturnRegisterTotals]
    Use: LnSalesReturnRegister
    Option: TotalOpt
    Local: Field: fwf: Align: Right
    Local: Field: default: Style: Normal Bold
    Local: Field: qtyf: Set As: $$Total:qtyf
    Local: Field: qtyf2: Set As: $$Total:qtyf2
    Local: Field: amtf: Set As: $$Total:amtf
    Local: Field: fwf: Set As: "Total"

;===============================================================================
; End of SALESRETURNREGISTER.TXT (with documentation comments)
;===============================================================================
