; Created By: Prakash on 2024-11-11 12:11, ID: 


     [#menu: Gateway of Tally]
        add: Option: BatchWiseNegativeStockLock  : @@cwDebug

     [#menu: Inventory Statements]
        add: Option: BatchWiseNegativeStockLock ;; : @@BatchWiseNegativeStockDemoLock

       
  /*
     [#menu : cw_Debug_menu]   
        add: Item: before: @@locQuit: @@BatchWiseNegativeStockReport: Display: RepBatchWiseNegativeStock
  */


     [!menu: BatchWiseNegativeStockLock]
        add: Item: before: @@locQuit: @@BatchWiseNegativeStockReport: Display: RepBatchWiseNegativeStock
        add: Item: before: @@locQuit: Blank
        
    [System: formula]
   BatchWiseNegativeStockReport: "Batch Wise Negative Stock"
;; BatchWiseNegativeStockDemoLock: $$MachineDate < $$Date:"01/12/2023"
     
    [Report: RepBatchWiseNegativeStock]
        use: Dsp Template
     ;; Use: Range Value Template
        Use: Range  Template
        
      Title: @@BatchWiseNegativeStockReport
   Printset: Report Title: @@BatchWiseNegativeStockReport

       Form: FrmBatchWiseNegativeStock

     Export: Yes

        set: svfromdate : ##svcurrentdate
        set: svTodate   : ##svcurrentdate

Local:Button:RelReports: Inactive: Yes
     
      [Form: FrmBatchWiseNegativeStock]
        use: DSP Template
       Part: DspAccTitles,PrtTitle0BatchWiseNegativeStock,PrtBatchWiseNegativeStock
      Width: 100% Page
     Height: 100% Page
     delete: page break
        add: page break: BatchWiseNegativeStockbotbrk,BatchWiseNegativeStockbotOpbrk
Bottom Toolbar Buttons 	: BottomToolBarBtn1, BottomToolBarBtn3, BottomToolBarBtn8, BottomToolBarBtn9, BottomToolBarBtn10, BottomToolBarBtn11,BottomToolBarBtn12

ADD: Button: Save View, Change View

     option: enable Range filters

 ;;    local : button : report config : action :modify variable: BatchWiseNegativeStockConfigure

      [part: BatchWiseNegativeStockbotBrk]
       line: EXPINV PageBreak
     border: thin top

      [part: BatchWiseNegativeStockbotopbrk]
        use: dspacctitles
  add: part: BatchWiseNegativeStockTitlePart

      [part: BatchWiseNegativeStockTitlePart]
       line: LnBatchWiseNegativeStockTitle
       
      [line: LnBatchWiseNegativeStockCurrPeriod]
      field: fwf,fwf2
      Local: field: fwf2: Align: Right
      Local: Field: fwf: Style: normal bold
      Local: Field: fwf2: Style: normal bold
      Local: Field: fwf2: Set As: @@dspDateStr
  invisible: $$inprintmode

      [part: PrtTitle0BatchWiseNegativeStock]
      line : LnBatchWiseNegativeStockCurrPeriod
      
      [Part: PrtBatchWiseNegativeStock]
       Line: LnBatchWiseNegativeStockTitle,LnBatchWiseNegativeStock
bottom Line: LnBatchWiseNegativeStockTotals
     repeat: LnBatchWiseNegativeStock: ColBatchWiseNegativeStock
     scroll: Vertical
 Common Border: YEs
      Total: Qtyf,amtf

; Main Collection

[Collection: ColBatchWiseNegativeStock]
use : StockItem
filter: ColBatchWiseNegativeStockFilter ,cwUOMPCS
    [system: Formula]
ColBatchWiseNegativeStockFilter: if $closingBalance <> 0 then yes else $$filtervalue:$closingbalance:cwBatchOfItemX:1:cwBatchHasNegativeStock > 0
cwBatchHasNegativeStock : $$isNegative:$closingBalance
cwUOMPCS : $baseUnits = "PCS"


[collection: cwBatchOfItemX]
use : cwBatchOfItem
FILTER :CWHASSTOCKx
;; {11.Nov.24 19:36} sort : @@default : if $closingbalance < 0 then 1 else 2

[System: Formula]
CWHASSTOCKx : $closingBalance <> 0


      [Line: LnBatchWiseNegativeStockTitle]
        use: LnBatchWiseNegativeStock
     option: titleopt
;;    local: field:default: set as: $$DescName
local:field: sdf: set as: "Date"
local:field: nf: set as: "Name"
local:field: nf2: set as: "Group"
local:field: qtyf: set as: "Qty."
local:field: amtf: set as: "Value"
Local: Field: ratepf: Set As: "Rate"
      local: field: default : style: normal bold

; Main Line
      [Line: LnBatchWiseNegativeStock]
field: numf2, nf2,nf3,nf,qtyf,ratepf,amtf
Local: Field: nf2: Set As: $parent
Local: Field: nf: Set As: $name
Local: Field: qtyf: Set As: $closingBalance
Local: Field: amtf: Set As: $closingValue
Local: Field: ratepf: Set As: #amtf / #qtyf

Local: Field: numf2: Set As: if $$explodelevel = 0 then $$line else $$line
explode : expBatchWiseNegativeStock : $$keyExplode or ##explodeFlag

[part: expBatchWiseNegativeStock]
line: expBatchWiseNegativeStock
repeat : expBatchWiseNegativeStock : cwBatchOfItemX

Local: Field: nf3: Set As: $godownname

[line: expBatchWiseNegativeStock]
use: LnBatchWiseNegativeStock
delete : explode
indent : $$explodeLevel * 2


   ;------------------------------  Alter Voucher Start (4.1)

        [Key: BatchWiseNegativeStockDisplayOnEnter]
	 Key: ctrl + enter
      Action: Display: BatchWiseNegativeStockDisplayVoucher

 	
     [Report: BatchWiseNegativeStockDisplayVoucher]
 	 Use: Vch Display
	Form: Vch Display
      Object: Voucher:  #BatchWiseNegativeStockmastid
	

        [Field: BatchWiseNegativeStockmastid]
	Set as:"ID:"+$$String:$masterid
	Invisible:Yes


   ;------------------------------  Alter Voucher End (4.1)



      [line: LnBatchWiseNegativeStockTotals]
        use: LnBatchWiseNegativeStock
     option: totalOpt
      local: field: fwf: align: right
      local: field: default : style: normal bold
      local: field: qtyf: set as: $$total:qtyf
      local: field: fwf: set as: "Total"
      local: field: fwf: set as: ""
      local: field: amtf : set as :  $$total:amtf


