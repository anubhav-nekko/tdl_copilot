;===============================================================================
; ITEMLEVEL.TXT
; Created By: Taniya on 2019-11-29 11:10, ID:
; Purpose: Adds image viewing integration to item and batch screens in Tally,
;          allowing users to view item images from a configured base path.
;===============================================================================

;------------------------------------------------------------------------------
; Add image "View" field to the first column of item entry if document management is enabled
;------------------------------------------------------------------------------

[#Line: EI ColumnOne]
add:option:cweicoloptimg:@@cwdocManagementEnable

[!line:cweicoloptimg]
add:right fields:atbeginning:snf8
Local: Field: snf8: info:"View"
Local: Field: snf8: Style: Normal Bold
Local: field: snf8: Align: right

;------------------------------------------------------------------------------
; Add image field to the second column of item entry if document management is enabled
;------------------------------------------------------------------------------

[#Line: EI Columntwo]
add:option:cweicomtwooptimg:@@cwdocManagementEnable

[!line:cweicomtwooptimg]
add:right fields:atbeginning:snf8
Local: Field: snf8: info:""

;------------------------------------------------------------------------------
; Add image subform trigger to inventory info lines (entry) if document management is enabled
;------------------------------------------------------------------------------

[#line:eiinvinfo]
add:option:eiinvinfooptimg:@@cwdocManagementEnable

[!line:eiinvinfooptimg]
add:right fields:atbeginning:cwlogical
Local: Field : cwlogical : SubForm :photoreport : $$value
Local: field: cwlogical: Align: centre
Local: field: cwlogical: Skip Forward:yes
Local: Field: cwlogical : Inactive : $$IsEnd:$StockItemName

;------------------------------------------------------------------------------
; Add image subform trigger to credit inventory info lines if document management is enabled
;------------------------------------------------------------------------------

[#line:ciinvinfo]
add:option:cweiinvinfooptimg:@@cwdocManagementEnable

[!line:cweiinvinfooptimg]
add:right fields:atbeginning:cwlogical
Local: Field: cwlogical : SubForm :photoreport : $$value
Local: field: cwlogical: Align: centre
Local: field: cwlogical: Skip Forward:yes
Local: Field: cwlogical : Inactive : $$IsEnd:$StockItemName

;===============================================================================
; Batch Allocations: Add image button to batch allocations form if enabled
;===============================================================================

[#Form: STKVCH BatchAllocations]
add:option:cwSTKVCHBatchAllocationsimgopt:@@cwdocManagementEnable

[!form:cwSTKVCHBatchAllocationsimgopt]
add:Button :cwshowimagebttn

;------------------------------------------------------------------------------
; "Show Image" button definition for batch allocations (Alt+I)
;------------------------------------------------------------------------------

[Button: cwshowimagebttn]
Title : $$LocaleString:"Show Image"
Key   : Alt + I
action : modify variable :photoreport

;------------------------------------------------------------------------------
; Photo report and form for displaying the image
;------------------------------------------------------------------------------

[report:photoreport]
form:photoforma

[form:photoforma]
part:photopartax,photopartax2,photoparta

;------------------------------------------------------------------------------
; Part: Display item name in the photo form
;------------------------------------------------------------------------------

[part:photopartax]
line:photopartaxline

[line:photopartaxline]
field:sp,nf
Local: Field: sp: info:"Item Name"
Local: Field: nf: Set As:$stockitemname
Local: field: nf: read only:yes
Local: Field: nf: Style: Normal Bold

;------------------------------------------------------------------------------
; Part: Display base path for the image in the photo form
;------------------------------------------------------------------------------

[part:photopartax2]
line:photopartaxline2

[line:photopartaxline2]
field:sp,nf
Local: Field: sp: info:"Base Path"
Local: Field: nf: Set As:@@cwphotoform
Local: field: nf: read only:yes
Local: Field: nf: Style: Normal Bold

;------------------------------------------------------------------------------
; Part: Display the image itself (graph type set to the image path)
;------------------------------------------------------------------------------

[part:photoparta]
line:photoimaline
graph type : @@cwphotoform

[line:photoimaline]
field:fwf
Local: Field: fwf: set as: ""

;------------------------------------------------------------------------------
; System formulas for image path construction
;------------------------------------------------------------------------------

[System: Formula]
cwphotoform:@@cwBasePath+@@cwbasepathlogo
cwbasepathlogo:$cwdoc:stockitem:$stockitemname
