;===============================================================================
; BARCODEFEATURES2.TXT
; Created By: Anil on 2023-07-08 15:04, ID:
; Purpose: Adds advanced configuration for additional batch-level custom fields
;          in Tally's barcode module, supporting up to 14 extra fields with
;          dynamic captions, table sources, and company-level UDF storage.
;===============================================================================

;------------------------------------------------------------------------------
; Add configuration line for enabling additional batch fields in Barcode Features
;------------------------------------------------------------------------------

[#Part:frmbarcodeapplocation ]
add:line:after:lncmpbatchfieldcaption:cwstkbatchlinexxx
;; {14.Jul.23 11:44} border:thin box

;------------------------------------------------------------------------------
; Configuration line for batch custom fields
;------------------------------------------------------------------------------

[line: cwstkbatchlinexxx]
field:cwCustomBatchFldsConfigTitle,cwCustomBatchFldsConfig

;------------------------------------------------------------------------------
; Formula to check if custom batch fields are enabled (company-level flag)
;------------------------------------------------------------------------------

[System: Formula]
;; {14.Jul.23 17:33} cwCustomBatchFldsEnabled :  $cwCustomBatchFldsEnabled:COMPANY:##SVCURRENTCOMPANY
cwCustomBatchFldsEnabled :  $cwenablebatchfield:COMPANY:##SVCURRENTCOMPANY

;------------------------------------------------------------------------------
; Title field for batch custom fields configuration
;------------------------------------------------------------------------------

[Field: cwCustomBatchFldsConfigTitle]
Use : long prompt
info: "Additional Fields in Batch ?"
;; {12.Nov.16 11:45} width : 0

;------------------------------------------------------------------------------
; Logical field to enable/disable batch custom fields and open subform for config
;------------------------------------------------------------------------------

[Field: cwCustomBatchFldsConfig]
Use: logical field
Set As: $cwenablebatchfield ;;$cwCustomBatchFldsEnabled
storage: cwenablebatchfield ;;cwCustomBatchFldsEnabled
set always : yes
set as : if $$value then yes else No
SubForm :stockitemBatchcaptionfrm : $$value

;------------------------------------------------------------------------------
; Subform for configuring batch custom field captions and options
;------------------------------------------------------------------------------

[Report: stockitemBatchcaptionfrm]
title :"Stock Item Batch Additional Fields"
Form: stockitemBatchcaptionfrm

[Form: stockitemBatchcaptionfrm]
Part: stockitemBatchcaptionfrm
width : 80% page

[Part: stockitemBatchcaptionfrm]
;; {14.Jul.23 17:37} line :lnCaption0x,lnCaption0ax,lnCaption1x,lnCaption2x,lnCaption3x,lnCaption4x,lnCaption5x,lnCaption6x,lnCaption9x,lnCaption10x,lnCaption11x,lnCaption12x,lnCaption13x,lnCaption14x,cwcostcodeline
line :lnCaption0x,lnCaption1x,lnCaption2x,lnCaption3x,lnCaption4x,lnCaption5x,lnCaption6x,lnCaption9x,lnCaption10x,lnCaption11x,lnCaption12x,lnCaption13x,lnCaption14x,cwcostcodeline

;------------------------------------------------------------------------------
; Example header line for batch custom fields section
;------------------------------------------------------------------------------

[Line: lnCaption0x]
field:fwfc
Local: Field: fwfc: info: "Stock Item Batch Additional Fields"
Local: Field: fwfc: Style: Normal Bold
Local: Field: fwfc: Border: thin bottom ;;left right

;------------------------------------------------------------------------------
; Example for each batch custom field configuration line (repeat for each field)
;------------------------------------------------------------------------------

[Line: lnCaption1x]
field:cwbcspx,cwbcnfx,sp,nf2,sp2,snf
space top :0.5
Local: Field: nf: info: ""
Local: Field: sp: info: "Table From :"
Local: Field: sp2: info: "Under :"
Local: Field: nf2: storage:cwtableFrom1 ;;cwbatchtableFrom1
Local: Field: snf: storage:cwUnder1 ;;cwbatchUnder1
Local: Field: nf2: table:colbatchtableFrom ,Not Applicable
Local: Field: nf2: Show table: Always
local: field:sp : inactive: not #cwCustombatchFldsConfig
local: field:sp2 : inactive: not #cwCustombatchFldsConfig
local: field: snf: inactive:$$issysname:#nf2
local: field: cwbcinss: inactive:$$issysname:#nf2
local: field: nf2: inactive:$$issysname:#cwbcnfx

;------------------------------------------------------------------------------
; Repeat similar lines for lnCaption2x ... lnCaption14x, each with their own fields
;------------------------------------------------------------------------------

; (Omitted for brevity, but all lines follow the same pattern as lnCaption1x)

;------------------------------------------------------------------------------
; Cost code and "Show in Stock Summary" configuration line
;------------------------------------------------------------------------------

[line:cwcostcodeline]
field:sp,snf,sp3,cwlogical
Local: Field: sp: info: "Cost Code from:"
Local: Field: snf: table:cwCostCodeFromx ,Not Applicable
Local: Field: snf: storage: cwbatchCostCodeFrom
Local: field: sp: Width: 14
Local: field: snf: Width: 16
Local: Field: snf: Style: Normal Bold
Local: Field: sp3: Set As: "Show in Stock Summary?"
Local: Field: cwlogical: storage:cwshowbatchfieldinStockSummary
Local: field: sp3: Width: 20

;------------------------------------------------------------------------------
; Collection for cost code source options
;------------------------------------------------------------------------------

[Collection: cwCostCodeFromx]
title :"Cost Code from"
listname : @@cwCostCodeFromF1
listname : @@cwCostCodeFromF2
listname : @@cwCostCodeFromF3

[System: Formula]
cwCostCodeFromF1 : "First"
cwCostCodeFromF2 : "Second"
cwCostCodeFromF3 : "Third"

;------------------------------------------------------------------------------
; Field definitions for batch custom field captions (examples)
;------------------------------------------------------------------------------

[field : cwbcspx]
use : short prompt
info: "Caption1:"

[field : cwbcsp2x]
use : short prompt
info: "Caption2:"

[field : cwbcsp3x]
use : short prompt
info: "Caption3:"

[field : cwbcsp4x]
use : short prompt
info: "Caption4:"

[field : cwbcsp5x]
use : short prompt
info: "Caption5:"

[field : cwbcsp6x]
use : short prompt
info: "Caption6:"

[field : cwbcsp7x]
use : short prompt
info: "Caption7:"

; ...repeat for cwbcsp9x to cwbcsp14x as per file

;------------------------------------------------------------------------------
; Field definitions for batch custom field storage (examples)
;------------------------------------------------------------------------------

[field : cwbcnfx]
use : name field
storage : cwbatchcaption1

[field : cwbcnf2x]
use : cwbcnfx
storage: cwbatchcaption2

[field : cwbcnf3x]
use : cwbcnfx
storage : cwbatchcaption3

[field : cwbcnf4x]
use : cwbcnfx
storage : cwproductStr2x

[field : cwbcnf5x]
use : cwbcnfx
storage : cwproductStr3x

[field : cwbcnf6x]
use : cwbcnfx
storage : cwproductStr4x

[field : cwbcnf7x]
use : cwbcnfx
storage : cwproductStr5x

; ...repeat for cwbcnf9x to cwbcnf14x as per file

;------------------------------------------------------------------------------
; Collection for "Table From" options in batch custom fields
;------------------------------------------------------------------------------

[Collection: colbatchtableFrom]
title:"Table From "
listname:@@cwforledger
listname:@@cwforcostcentre
listname:@@cwforcostcategory
listname:@@cwforgroup
listname:@@cwforstockgroup
listname:@@cwforstockcategory

;------------------------------------------------------------------------------
; System formulas for "Under" and "Table From" values for each field (examples)
;------------------------------------------------------------------------------

forunder1:$cwUnder1:COMPANY:##SVCURRENTCOMPANY
forunder2:$cwUnder2:COMPANY:##SVCURRENTCOMPANY
forunder3:$cwUnder3:COMPANY:##SVCURRENTCOMPANY
; ...repeat for forunder4 to forunder14

fortable1led:$cwtableFrom1:COMPANY:##SVCURRENTCOMPANY
fortable1ledx:@@fortable1led="ledger"
; ...repeat for each table/field index and type as per file

;------------------------------------------------------------------------------
; UDF declarations for batch custom fields, captions, and configuration flags
;------------------------------------------------------------------------------

[System: UDF]
cwCustomBatchFldsEnabled:logical:5001

cwproductStrx:string:5002
cwproductStr2x:string:5003
cwproductStr3x:string:5004
cwproductStr4x:string:5005
cwproductStr5x:string:5006
cwproductStr9x:string:5007
cwproductStr10x:string:5008
cwproductStr11x:string:5009
cwproductStr12x:string:5010
cwproductStr13x:string:5011
cwproductStr14x:string:5012
cwsizeStrx:string:5013
cwsortnoStrx:string:5014
cwShowItemsBatchInStockSummary:logical:5015

cwtableFrom1:string:5101
cwtableFrom2:string:5102
cwtableFrom3:string:5103
cwtableFrom4:string:5104
cwtableFrom5:string:5105
cwtableFrom6:string:5106
cwtableFrom7:string:5107
cwtableFrom9:string:5108
cwtableFrom10:string:5109
cwtableFrom11:string:5110
cwtableFrom12:string:5111
cwtableFrom13:string:5112
cwtableFrom14:string:5113

cwUnder1:string:5201
cwUnder2:string:5202
cwUnder3:string:5203
cwUnder4:string:5204
cwUnder5:string:5205
cwUnder6:string:5206
cwUnder7:string:5207
cwUnder9:string:5208
cwUnder10:string:5209
cwUnder11:string:5210
cwUnder12:string:5211
cwUnder13:string:5212
cwUnder14:string:5212
