;===============================================================================
; STOCKITEMMASTER.TXT
; Created By: Akshay on 2013-01-05 10:52, ID:
; Purpose: Adds advanced custom fields and attribute configuration to the Stock
;          Item master in Tally. Supports up to 14 user-defined fields, with
;          captions, table sources, and grouping, and integrates these into the
;          item master UI for flexible attribute management.
;===============================================================================

;------------------------------------------------------------------------------
; Company Operations Form: Switches for custom fields config based on Tally version
;------------------------------------------------------------------------------

[#Form: Company Operations]
    Switch   : cwCustomFldsLowerRel  : cwCustomFldsNotFor3.2  : ($$Number:$$ProdInfo:ProdReleaseAsStr) < 3.2
    Switch   : cwCustomFldsCurrenRel : cwCustomFldsFor3.2     : ($$Number:$$ProdInfo:ProdReleaseAsStr) >= 3.2

;------------------------------------------------------------------------------
; Custom Fields Config Lines for Company Features (for Tally < 3.2 and >= 3.2)
;------------------------------------------------------------------------------

[!Form : cwCustomFldsNOTFor3.2]
;; Adds lines for custom fields, batch, barcode, and cost tracking to company features (older Tally)
;; {12.Nov.16 11:22} Local: Part : CMP AccFeat Left : Add : Line : At End : cwCostTracking,cwCustomFldsConfig ,lnCaption2,lnCaption3,lnCaption4,lnCaption5,lnCaption6 +
;; {12.Nov.16 11:22} ,lnbcodeforeachqty ,lncmpbatchfieldcaption,lncmpbarcodefrombatch

[!Form : cwCustomFldsFor3.2]
;; Adds lines for custom fields, batch, barcode, and cost tracking to company features (Tally 3.2+)
;; {12.Nov.16 11:22} Local  : Part  : CMP TallyShopFeatures Left : Add :  Line : At End  : cwCostTracking,cwCustomFldsConfig ,lnCaption2,lnCaption3,lnCaption4,lnCaption5,lnCaption6 +
;; {12.Nov.16 11:22} ,lnbcodeforeachqty,lncmpbatchfieldcaption ,lncmpbarcodefrombatch

;------------------------------------------------------------------------------
; Custom Fields Configuration Line (Brand/Level 1)
;------------------------------------------------------------------------------

[Line : cwCustomFldsConfig]
Field : cwCustomFldsConfigTitle,cwCustomFldsConfig
Local: Field: short name field : info: "sales@circuitworld.in"
Local: Field: short name field: case : normal
Local: Field: short name field: Color : blue
Local: Field: short name field: width : 0
Local: Field: nf: info: ""
Local: Field: sp: info: "Table From :"
Local: Field: sp2: info: "Under :"
Local: Field: nf2: storage:cwtableFrom1
Local: Field: snf: storage:cwUnder1
Local: Field: nf2: table:coltableFrom ,Not Applicable
Local: Field: nf2: Show table: Always
local: field:cwbcsp : inactive: not #cwCustomFldsConfig
local: field:cwbcnf : inactive: not #cwCustomFldsConfig
local: field:sp : inactive: not #cwCustomFldsConfig
local: field:sp2 : inactive: not #cwCustomFldsConfig
local: field: snf: inactive:$$issysname:#nf2
local: field: nf2: inactive:$$issysname:#cwbcnf

;------------------------------------------------------------------------------
; Custom Fields Configuration Lines for Levels 2â€“14 (Style, Season, etc.)
; Each line follows the same structure as above, with its own storage fields.
;------------------------------------------------------------------------------

[Line: lnCaption2]
field:cwbcsp2,cwbcnf2,sp,nf3,sp2,snf2
Local: Field: nf: info: ""
Local: Field: sp: info: "Table From :"
Local: Field: sp2: info: "Under :"
Local: Field: nf3: storage:cwtableFrom2
Local: Field: snf2: storage:cwUnder2
Local: Field: nf3: table:coltableFrom ,Not Applicable
Local: Field: nf3: Show table: Always
local: field:cwbcsp2 : inactive: not #cwCustomFldsConfig
local: field:cwbcnf2 : inactive: not #cwCustomFldsConfig
local: field:sp : inactive: not #cwCustomFldsConfig
local: field:sp2 : inactive: not #cwCustomFldsConfig
local: field:nf3 : inactive: not #cwCustomFldsConfig
local: field:nf: inactive: not #cwCustomFldsConfig
Local: field: nf: Width:30
local: field: snf2: inactive:$$issysname:#nf3
local: field: nf3: inactive:$$issysname:#cwbcnf2
space top :0.5

; ... (Lines lnCaption3 to lnCaption14 follow the same pattern, each with its own fields and storage)

;------------------------------------------------------------------------------
; Field Definitions for Custom Captions and Storage (Examples)
;------------------------------------------------------------------------------

[field : cwbcsp]
use : short prompt
info: "Caption1:"

[field : cwbcsp2]
use : short prompt
info: "Caption2:"

[field : cwbcnf]
use : name field
storage : cwsortnoStr

[field : cwbcnf2]
use : cwbcnf
storage: cwsizeStr

; ... (Fields for cwbcnf3 to cwbcnf14, and cwbcsp3 to cwbcsp14, follow the same pattern)

;------------------------------------------------------------------------------
; Custom Fields SubForm for Stock Item Master
;------------------------------------------------------------------------------

[Field: cwCustomFldsConfigTitle]
Use : long prompt
info: "Stock Item has Additional Fields ?"

[Field: cwCustomFldsConfig]
Use: logical field
Set As: $cwCustomFldsEnabled
storage: cwCustomFldsEnabled
SubForm :stockitemcaptionfrm : $$value

[Report: stockitemcaptionfrm]
title :"Stock Item Additional Fields"
Form: stockitemcaptionfrm

[Form: stockitemcaptionfrm]
Part: stockitemcaptionfrm
width : 80% page

[Part: stockitemcaptionfrm]
line :lnCaption0,lnCaption0a,lnCaption1,lnCaption2,lnCaption3,lnCaption4,lnCaption5,lnCaption6,lnCaption9,lnCaption10,lnCaption11,lnCaption12,lnCaption13,lnCaption14

;------------------------------------------------------------------------------
; Table Source Collection for Attribute Fields
;------------------------------------------------------------------------------

[Collection: coltableFrom]
title:"Table From "
listname:@@cwforledger
listname:@@cwforcostcentre
listname:@@cwforcostcategory
listname:@@cwforgroup
listname:@@cwforstockgroup
listname:@@cwforstockcategory

;------------------------------------------------------------------------------
; System Formulas for Custom Field Enablement, Table Sources, and Under Values
;------------------------------------------------------------------------------

[System: Formula]
cwCustomFldsEnabled :  $cwCustomFldsEnabled:COMPANY:##SVCURRENTCOMPANY

cwforledger:"Ledger"
cwforcostcentre:"Cost Centre"
cwforcostcategory:"Cost Category"
cwforgroup:"Group"
cwforstockgroup:"Stock Group"
cwforstockcategory:"Stock Category"

forunder1:$cwUnder1:COMPANY:##SVCURRENTCOMPANY
forunder2:$cwUnder2:COMPANY:##SVCURRENTCOMPANY
forunder3:$cwUnder3:COMPANY:##SVCURRENTCOMPANY
forunder4:$cwUnder4:COMPANY:##SVCURRENTCOMPANY
forunder5:$cwUnder5:COMPANY:##SVCURRENTCOMPANY
forunder6:$cwUnder6:COMPANY:##SVCURRENTCOMPANY
forunder7:$cwUnder7:COMPANY:##SVCURRENTCOMPANY
forunder8:$cwUnder8:COMPANY:##SVCURRENTCOMPANY
forunder9:$cwUnder9:COMPANY:##SVCURRENTCOMPANY
forunder10:$cwUnder10:COMPANY:##SVCURRENTCOMPANY
forunder11:$cwUnder11:COMPANY:##SVCURRENTCOMPANY
forunder12:$cwUnder12:COMPANY:##SVCURRENTCOMPANY
forunder13:$cwUnder13:COMPANY:##SVCURRENTCOMPANY
forunder14:$cwUnder14:COMPANY:##SVCURRENTCOMPANY

; ... (fortableNled, fortableNgr, etc., for all 14 levels, as in the original file)

;------------------------------------------------------------------------------
; Stock Item Master UI: Add custom attribute entry part after STKI Basic
;------------------------------------------------------------------------------

[#Form: Stock Item]
 add : part : after : STKI Basic : prtItemCoal

[part:prtItemCoal]
 line:lnItemsortno,lnItemsortno2,lnItemsortno3,lnItemsortno4

;------------------------------------------------------------------------------
; Lines and Fields for Attribute Entry (Brand, Size, Product, etc.)
;------------------------------------------------------------------------------

[line:lnItemsortno]
 field: Sp,stksnf,sp2,stksnf2,sp3,stksnf3
 Local: Field: sp: info: $cwsortnoStr:COMPANY:##SVCURRENTCOMPANY
 Local: Field: sp2: info: $cwsizeStr:COMPANY:##SVCURRENTCOMPANY
 Local: Field: sp3: info: $cwproductStr:COMPANY:##SVCURRENTCOMPANY
 Local: Field: snf: storage:cwsortno
 Local: Field: snf2: storage:cwsize
 Local: Field: snf3: storage:cwproduct
 Local: Field: default: Color : blue
 local: field: sp: inactive: (not @@cwhascustomudf) or $$issysname:$cwsortnoStr:COMPANY:##SVCURRENTCOMPANY
 local: field: sp2: inactive: (not @@cwhascustomudf) or $$issysname:$cwsizeStr:COMPANY:##SVCURRENTCOMPANY
 local: field: sp3: inactive: (not @@cwhascustomudf) or $$issysname:$cwproductStr:COMPANY:##SVCURRENTCOMPANY

; ... (Lines lnItemsortno2, lnItemsortno3, lnItemsortno4, and their fields follow the same pattern for other attributes)

;------------------------------------------------------------------------------
; Cost Tracking Line and Fields
;------------------------------------------------------------------------------

[line : cwCostTracking]
field : long prompt,cwlogical2,medium prompt,snf, sp4,snf2,snf3,  sp3,numf,sp5,snf5
Local: Field: long prompt: info: "Enable Cost Coding ?"
Local: field: sp: Width: 0
Local: field: sp2: Width: 0
Local: field: sp3: Width: 14
Local: field: numf: Width: 5
Local: Field: cwlogical2: storage: cwCostTracking
Local: Field: medium prompt: info: "Cost String [0-9] :"
Local: Field: medium prompt: width :0
Local: Field: snf: storage: cwCostStr
local: field: snf: Case: upper
local: Field: SNF: max: 10
local: Field: SNF: width: 12
local: Field: SNF2: width: 10
local: Field: SNf3: width: 10
Local: Field: sp3: info: "Cost Multiplier:"
Local: Field: numf: storage:cwCostMultiplier
Local: Field: numf: Set As: if $$isempty:$$value then 1 else $$value
local: field: snf: inactive: not #cwlogical2 = yes
local: field: medium prompt: inactive: not #cwlogical2 = yes
local: field: sp3: inactive: not #cwlogical2 = yes
local: field: numf: inactive: not #cwlogical2 = yes
local: field: snf2: inactive: not #cwlogical2 = yes
Local: field: numf: Align: left
Local: Field: sp4: info: "Cost From:"
Local: Field: snf2: storage: cwCostFrom
Local: Field: snf2: table: costfrom
Local: Field: snf3: inactive: $cwCostFrom <>  @@cwCFPriceList
Local: Field: snf3: storage: cwCostPL
Local: Field: snf3: table: pricelevels,Not Applicable
Local: Field: sp5: info: "Cost Code2:"
Local: Field: snf5: table: pricelevels,Not Applicable
Local: Field: snf5: storage: cwrtlpricelist

;------------------------------------------------------------------------------
; System Formulas for Cost Coding Options
;------------------------------------------------------------------------------

[System: Formula]
cwcmpCostFrom : $cwCostFrom:COMPANY:##SVCURRENTCOMPANY
cwCostPL : $cwCostPL:COMPANY:##SVCURRENTCOMPANY
cwCFVoucherRate : "Voucher Rate"
cwCFPriceList   : "Price List"
cwCFStandardCost: "Standard Cost"
cwCFStandardSale: "Standard Sale"

[collection : costfrom]
title:"Cost from"
listname : @@cwCFVoucherRate
listname : @@cwCFPriceList
listname : @@cwCFStandardCost
listname : @@cwCFStandardSale
